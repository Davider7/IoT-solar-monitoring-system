<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IoT Solar Monitoring Dashboard</title>
<style>
:root{ --green:#28a745; --yellow:#ffc107; --red:#dc3545; --bg:#f5f7fb; --card:#ffffff; --ink:#222; }
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
header{padding:14px 16px;color:#fff;text-align:center;font-weight:600;letter-spacing:.2px}
.banner.green{background:var(--green)} .banner.yellow{background:var(--yellow)} .banner.red{background:var(--red)}
.wrap{padding:14px 16px;max-width:1100px;margin:0 auto}
.tabs{display:flex;gap:8px;margin:8px 0 0}
.tab{flex:1;padding:10px 12px;background:#e6e9f2;border:none;border-radius:8px 8px 0 0;cursor:pointer;font-weight:600}
.tab.active{background:#fff}
.panel{display:none;background:#fff;padding:14px;border-radius:0 8px 8px 8px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.panel.active{display:block}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin:10px 0 4px}
.card{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 1px 5px rgba(0,0,0,.05);text-align:center}
.card h3{margin:0 0 6px;font-size:14px;font-weight:700;color:#555}
.card p{margin:0;font-size:18px;font-weight:700}
.charts{display:grid;gap:12px;margin-top:10px}
.chart{background:#fff;border-radius:10px;padding:10px;box-shadow:0 1px 5px rgba(0,0,0,.05);cursor:pointer}
svg{width:100%;height:180px;display:block}
.legend{display:flex;gap:10px;font-size:12px;margin-top:6px;color:#555;flex-wrap:wrap}
.swatch{width:10px;height:10px;border-radius:2px;display:inline-block;margin-right:4px}
.alert{margin-top:10px;padding:10px;border-radius:8px;font-weight:700}
.alert.green{background:#e9f7ef;color:#146c2e}
.alert.yellow{background:#fff7e0;color:#7a5d00}
.alert.red{background:#ffe8e8;color:#8a1f1f}
.bars{display:grid;gap:16px}
.barbox label{font-size:14px;font-weight:700;color:#555}
.bar{height:18px;background:#eaeef7;border-radius:12px;overflow:hidden;margin-top:6px}
.fill{height:100%;text-align:right;color:#fff;font-size:12px;line-height:18px;padding-right:6px}
.fill.green{background:var(--green)} .fill.yellow{background:var(--yellow)} .fill.red{background:var(--red)}
footer{font-size:12px;color:#666;text-align:center;margin:14px 0}
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-top:8px}
.btn{background:#111;color:#fff;border:none;border-radius:8px;padding:8px 12px;font-weight:700;cursor:pointer}
.note{font-size:12px;color:#666}

/* --- Modal for Chart Details --- */
#chartModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1000;}
#chartModal .box{background:#fff;padding:20px;max-width:500px;border-radius:10px;position:relative;}
#closeModal{position:absolute;top:10px;right:14px;font-weight:700;cursor:pointer;}
</style>
</head>
<body>

<header id="banner" class="banner green">System Normal</header>

<div class="wrap">
  <div class="tabs">
    <button class="tab active" onclick="showTab(0)">Live Data</button>
    <button class="tab" onclick="showTab(1)">Solar Panel State</button>
  </div>

  <!-- Live Data Panel -->
  <section class="panel active" id="livePanel">
    <div class="grid">
      <div class="card"><h3>Voltage</h3><p id="vTxt">-- V</p></div>
      <div class="card"><h3>Current</h3><p id="cTxt">-- A</p></div>
      <div class="card"><h3>Power</h3><p id="pTxt">-- W</p></div>
      <div class="card"><h3>Light</h3><p id="lTxt">-- lx</p></div>
      <div class="card"><h3>Temperature</h3><p id="tTxt">-- °C</p></div>
    </div>

    <div class="charts">
      <div class="chart" onclick="showDetails('voltage')">
        <strong>Voltage</strong>
        <svg id="voltageSvg"></svg>
        <div class="legend"><span class="swatch" style="background:#007bff"></span>Latest V with timestamp</div>
      </div>
      <div class="chart" onclick="showDetails('power')">
        <strong>Power</strong>
        <svg id="powerSvg"></svg>
        <div class="legend"><span class="swatch" style="background:#28a745"></span>Latest W with timestamp</div>
      </div>
      <div class="chart" onclick="showDetails('lux')">
        <strong>Light (Lux)</strong>
        <svg id="luxSvg"></svg>
        <div class="legend"><span class="swatch" style="background:#ff9900"></span>Latest Lux with timestamp</div>
      </div>
    </div>

    <div id="liveAlert" class="alert green">System Normal</div>

    <div class="row">
      <button class="btn" onclick="downloadLog()">Download Log (CSV)</button>
      <span id="clock" class="note">--</span>
    </div>
  </section>

  <!-- Solar Panel State Panel -->
  <section class="panel" id="statePanel">
    <div class="bars">
      <div class="barbox">
        <label>Performance</label>
        <div class="bar"><div id="perfFill" class="fill green" style="width:0%">0%</div></div>
        <div class="note">How close current power is to expected power for the present light level.</div>
      </div>
      <div class="barbox">
        <label>Cleanliness</label>
        <div class="bar"><div id="cleanFill" class="fill yellow" style="width:0%">0%</div></div>
        <div class="note">Drops if sunlight is strong but power is low — likely dust or dirt.</div>
      </div>
      <div class="barbox">
        <label>Efficiency</label>
        <div class="bar"><div id="effFill" class="fill red" style="width:0%">0%</div></div>
        <div class="note">Combined score from performance and cleanliness.</div>
      </div>
    </div>
  </section>

  <footer id="footer">Last update: --</footer>
</div>

<!-- Chart Details Modal -->
<div id="chartModal">
  <div class="box">
    <span id="closeModal">✖</span>
    <h3 id="modalTitle"></h3>
    <p id="modalText"></p>
  </div>
</div>

<script>
// ---- Chart Details Data ----
const details = {
  voltage: {
    title:"Voltage Chart",
    text:"This shows the solar panel voltage (V). Voltage indicates how well the panel is connected and if it is receiving enough sunlight. A sudden drop may point to wiring or shading issues."
  },
  power: {
    title:"Power Chart",
    text:"This shows the solar panel output power (W), which is calculated as Voltage × Current. It is the best indicator of real-time performance and efficiency of the panel."
  },
  lux: {
    title:"Light (Lux) Chart",
    text:"This shows sunlight intensity (lx). A higher lux reading means stronger sunlight. It helps compare how much light is available versus how much power is actually generated."
  }
};

function showDetails(type){
  document.getElementById('modalTitle').textContent = details[type].title;
  document.getElementById('modalText').textContent = details[type].text;
  document.getElementById('chartModal').style.display="flex";
}

document.getElementById('closeModal').onclick=function(){
  document.getElementById('chartModal').style.display="none";
};
</script>

</body>
</html>